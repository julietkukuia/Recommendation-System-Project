# **ğŸ—“ Day 2 â€“ Outlier Removal, Category Enrichment & Sparse Matrix Creation**

**Date: 2025-08-10**
Author: Juliet Fafali Kukuia
Project: Personalised Recommendation System using E-commerce Behaviour Data
âœ… Tasks Completed

    Outlier Detection & Removal

        Calculated user and item activity quantiles.

        Set thresholds: users >163 interactions and items >2302 interactions flagged as unrealistic.

        Dropped 1,472,348 rows (~25% of dataset) to reduce noise from bots/bulk buyers.

    Category Missing Value Handling

        Found 5.57% NaNs in categoryid.

        Forward-filled category IDs within each itemid timeline to preserve chronological consistency.

        Marked unknown categories for tracking.

    Merging with Category Tree

        Joined events_filtered with category_tree.csv.

        Extracted parentid and category_depth for each category.

        Resolved merge column conflicts (parentid_x, parentid_y) by renaming to a unified parentid.

    Encoding & Sparse Matrix Preparation

        Encoded visitorid â†’ user_id and itemid â†’ item_id using LabelEncoder.

        Assigned event weights: view=1, addtocart=3, transaction=5.

        Created a sparse CSR interaction matrix:

            Shape: (1,376,968 users Ã— 230,615 items)

            Non-zero entries: 4,427,915 interactions

            Saved as data/interaction_sparse.pkl for modelling.

ğŸ“Š Key Findings / Observations

    Extreme outliers can heavily skew recommendations and memory usage.

    Forward-fill method proved reliable for filling missing categoryid values in event timelines.

    Sparse matrix storage reduced potential memory usage from ~2.5 TB (dense) to a manageable size.

    A random preview of the interaction matrix confirms meaningful userâ€“item connections.

âš ï¸ Challenges & Fixes
Challenge	How It Was Resolved
Duplicate merge columns (parentid_x / parentid_y) after joining with category tree	Explicitly selected and renamed columns before merge.
Memory errors when pivoting to dense format	Switched to CSR sparse matrix format using scipy.sparse.csr_matrix.
Empty preview when sampling interactions	Adjusted sampling to ensure overlap between selected users and items.
ğŸ”œ Next Steps

    Conduct bonus EDA to strengthen final report:

        Time-based trends â€“ interaction patterns over time.

        Category-level popularity â€“ most purchased/engaged categories.

        Repeat user behaviour â€“ retention and purchase patterns.

        Conversion funnel â€“ view â†’ add-to-cart â†’ purchase rates.

    Implement ALS recommender model using the sparse matrix.

    Evaluate recommendation quality and diversity.

ğŸ“‚ Files Updated / Created
File	Description
notebooks/data_cleaning_enrichment.ipynb	Outlier filtering, missing value handling, category enrichment.
data/category_tree.csv	Category hierarchy data for enrichment.
data/interaction_sparse.pkl	Sparse userâ€“item interaction matrix for model training.
ğŸ§  Key Learnings

    Outlier removal is a critical preprocessing step for scalable recommender systems.

    Sparse matrices are essential for handling large-scale interaction data efficiently.

    Careful handling of merge keys avoids data duplication or column conflicts.
